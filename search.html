<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Căutare în articole</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        #results { margin-top: 20px; }
        .result { margin-bottom: 20px; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
        .highlight { background-color: yellow; font-weight: bold; }
        #debug { margin-top: 20px; border: 1px solid #ccc; padding: 10px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>Căutare în articole</h1>
    
    <input type="text" id="searchInput" placeholder="Introduceți fraza de căutat">
    <button onclick="search()">Caută</button><br><br>

    <div id="results"></div>
    <div id="debug"></div>

    <script>
        let articles = [];
        let debugInfo = [];

        function log(message) {
            console.log(message);
            debugInfo.push(message);
            document.getElementById('debug').textContent = debugInfo.join('\n');
        }

function normalizeText(text) {
    return decodeHtmlEntities(text)
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .toLowerCase()
        .replace(/[^a-z0-9\s]/g, '');
}

function decodeHtmlEntities(text) {
    const textArea = document.createElement('textarea');
    textArea.innerHTML = text;
    return textArea.value;
}

        function getFileList() {
            log("Încercare de obținere a listei de fișiere...");
            const xhr = new XMLHttpRequest();
            xhr.open('GET', 'file_list.json', true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    const fileNames = JSON.parse(xhr.responseText);
                    log(`Fișiere găsite: ${fileNames.join(', ')}`);
                    loadArticles(fileNames);
                } else if (xhr.readyState === 4 && xhr.status !== 200) {
                    log(`Eroare la obținerea listei de fișiere: ${xhr.status}`);
                }
            };
            xhr.send();
        }

        function loadArticles(fileNames) {
            let filesLoaded = 0;
            articles = [];

            fileNames.forEach((fileName) => {
                const xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        const text = xhr.responseText;
                        const items = text.split('--------');
                        items.forEach((item) => {
                            if (item.trim() !== '') {
                                articles.push({ content: item.trim() });
                            }
                        });

                        log(`Fișier încărcat: ${fileName}, articole: ${items.length}`);

                        filesLoaded++;
                        if (filesLoaded === fileNames.length) {
                            log(`Încărcate ${articles.length} articole din ${fileNames.length} fișiere.`);
                        }
                    } else if (xhr.readyState === 4 && xhr.status !== 200) {
                        log(`Eroare la încărcarea fișierului ${fileName}: ${xhr.status}`);
                    }
                };
                xhr.open('GET', fileName, true);
                xhr.send();
            });
        }

function search() {
    const query = document.getElementById('searchInput').value.trim();
    const resultsDiv = document.getElementById('results');
    resultsDiv.innerHTML = '';
    debugInfo = [];

    log(`Searching for: "${query}"`);
    const normalizedQuery = normalizeText(query);
    let foundResults = 0;

    articles.forEach((article, index) => {
        const sentences = article.content.split(/(?<=[.!?])\s+/);
        sentences.forEach((sentence) => {
            if (normalizeText(sentence).includes(normalizedQuery)) {
                foundResults++;
                const highlightedSentence = highlightText(sentence, query);

                const div = document.createElement('div');
                div.className = 'result';
                div.innerHTML = highlightedSentence;
                resultsDiv.appendChild(div);

                log(`Found in article ${index + 1}`);
            }
        });
    });

    log(`Results found: ${foundResults}`);
    if (foundResults === 0) {
        resultsDiv.innerHTML = '<p>No results found.</p>';
    }
}


function highlightText(text, query) {
    // Split the query into individual words and escape special characters for regex use.
    const words = query.split(/\s+/).map(word => escapeRegExp(decodeHtmlEntities(word)));

    // Create a regex pattern to find all words in the text, ignoring case and whole word boundaries.
    const regex = new RegExp(`(${words.join("|")})`, 'gi');

    // Replace found words with highlighted versions.
    return text.replace(regex, `<span class="highlight">$1</span>`);
}



function escapeRegExp(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

        window.onload = getFileList;
    </script>
</body>
</html>
